<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mystats &mdash; custom_modules 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="custom_modules 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">custom_modules 0.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for mystats</h1><div class="highlight"><pre>
<span class="ch">#!/usr/bin/python -W ignore::DeprecationWarning</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Sampling</span>

<div class="viewcode-block" id="rv2d_discrete"><a class="viewcode-back" href="../code.html#mystats.rv2d_discrete">[docs]</a><span class="k">class</span> <span class="nc">rv2d_discrete</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A generic discrete 2D random variable class meant for subclassing.</span>
<span class="sd">    Similar to scipy.stats.rv_discrete.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    likelihoods : array-like</span>
<span class="sd">        N x M array of relative likelihoods corresponding to parameter 1 and 2</span>
<span class="sd">        values.</span>
<span class="sd">    param_grid1, param_grid2 : array-like</span>
<span class="sd">        Parameter values corresponding to element positions of likelihoods.</span>
<span class="sd">        The lengths of param_grid1 and param_grid2 must be N and M respectively.</span>
<span class="sd">    param_name1, param_name2 : str</span>
<span class="sd">        Names of parameters 1 and 2.</span>
<span class="sd">    L_scalar : float</span>
<span class="sd">        Inverse scalar of the likelihoods to calculate the 2D PDF. The</span>
<span class="sd">        likelihoods are divided by the minimum non-zero likelihood otherwise.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihoods</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param_grid1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param_grid2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">param_name1</span><span class="o">=</span><span class="s1">&#39;param1&#39;</span><span class="p">,</span> <span class="n">param_name2</span><span class="o">=</span><span class="s1">&#39;param2&#39;</span><span class="p">,</span> <span class="n">L_scalar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">rv2d_discrete</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">&lt;</span> <span class="mf">1e-16</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid1</span> <span class="o">=</span> <span class="n">param_grid1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid2</span> <span class="o">=</span> <span class="n">param_grid2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_name1</span> <span class="o">=</span> <span class="n">param_name1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_name2</span> <span class="o">=</span> <span class="n">param_name2</span>
        <span class="k">if</span> <span class="n">L_scalar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">likelihoods</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span> <span class="o">=</span> <span class="n">L_scalar</span>

        <span class="c1"># Scale likelihoods so that min value is an integer</span>
        <span class="n">likelihoods_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span><span class="p">)</span>

        <span class="c1"># Initialize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">likelihoods_scaled</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Create numbers of parameter pairs proportional to the parameter pair</span>
        <span class="c1"># likelihood</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_grid1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">param2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_grid2</span><span class="p">):</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">likelihoods_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">L</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">count</span> <span class="o">+</span> <span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="n">L</span>

<div class="viewcode-block" id="rv2d_discrete.rvs"><a class="viewcode-back" href="../code.html#mystats.rv2d_discrete.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>

        <span class="sd">&#39;&#39;&#39; Returns parameters random sample from the pdf.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randint</span>

        <span class="c1"># Get a random index of the pdf</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># extract the parameters from the pdf</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">params</span>
</div></div>
<div class="viewcode-block" id="rv3d_discrete"><a class="viewcode-back" href="../code.html#mystats.rv3d_discrete">[docs]</a><span class="k">class</span> <span class="nc">rv3d_discrete</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A generic discrete 3D random variable class meant for subclassing.</span>
<span class="sd">    Similar to scipy.stats.rv_discrete.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    likelihoods : array-like</span>
<span class="sd">        N x M X P array of relative likelihoods corresponding to parameter 1</span>
<span class="sd">        2, and 3 values.</span>
<span class="sd">    param_grid1, param_grid2, param_grid3: array-like</span>
<span class="sd">        Parameter values corresponding to element positions of likelihoods.</span>
<span class="sd">        The lengths of param_grid1, param_grid2 and param_grid3 must be N and M</span>
<span class="sd">        and P respectively.</span>
<span class="sd">    param_name1, param_name2, param_name3 : str</span>
<span class="sd">        Names of parameters 1, 2 and 3.</span>
<span class="sd">    L_scalar : float</span>
<span class="sd">        Inverse scalar of the likelihoods to calculate the 3D PDF. The</span>
<span class="sd">        likelihoods are divided by the minimum non-zero likelihood otherwise.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihoods</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param_grid1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param_grid2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">param_grid3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">param_name1</span><span class="o">=</span><span class="s1">&#39;param1&#39;</span><span class="p">,</span> <span class="n">param_name2</span><span class="o">=</span><span class="s1">&#39;param2&#39;</span><span class="p">,</span>
            <span class="n">param_name3</span><span class="o">=</span><span class="s1">&#39;param3&#39;</span><span class="p">,</span> <span class="n">L_scalar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">rv3d_discrete</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="c1">#self.likelihoods = np.squeeze(likelihoods)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">=</span> <span class="n">likelihoods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">&lt;</span> <span class="mf">1e-16</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid1</span> <span class="o">=</span> <span class="n">param_grid1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid2</span> <span class="o">=</span> <span class="n">param_grid2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid3</span> <span class="o">=</span> <span class="n">param_grid3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_name1</span> <span class="o">=</span> <span class="n">param_name1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_name2</span> <span class="o">=</span> <span class="n">param_name2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_name3</span> <span class="o">=</span> <span class="n">param_name3</span>
        <span class="k">if</span> <span class="n">L_scalar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">[</span><span class="n">likelihoods</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span> <span class="o">=</span> <span class="n">L_scalar</span>

        <span class="c1"># Scale likelihoods so that min value is an integer</span>
        <span class="n">likelihoods_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihoods</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_scalar</span><span class="p">)</span>

        <span class="c1"># Initialize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">likelihoods_scaled</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Create numbers of parameter pairs proportional to the parameter pair</span>
        <span class="c1"># likelihood</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_grid1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">param2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_grid2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">param3</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_grid3</span><span class="p">):</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">likelihoods_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">L</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">count</span> <span class="o">+</span> <span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="n">L</span>

<div class="viewcode-block" id="rv3d_discrete.rvs"><a class="viewcode-back" href="../code.html#mystats.rv3d_discrete.rvs">[docs]</a>    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>

        <span class="sd">&#39;&#39;&#39; Returns parameters random sample from the pdf.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randint</span>

        <span class="c1"># Get a random index of the pdf</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># extract the parameters from the pdf</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">params</span>
</div></div>
<div class="viewcode-block" id="calc_symmetric_error"><a class="viewcode-back" href="../code.html#mystats.calc_symmetric_error">[docs]</a><span class="k">def</span> <span class="nf">calc_symmetric_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array-like</span>

<span class="sd">    y : array-like, optional</span>
<span class="sd">        If provided, treated as the PDF of x</span>

<span class="sd">    &#39;&#39;&#39;</span>


    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simps</span> <span class="k">as</span> <span class="n">integrate</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c1">#raise ValueError(&#39;x and y must have lengths &gt; 3&#39;)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="c1"># Create histogram with bin widths normalized by the density of values</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;y values mush be greater than 0&#39;</span><span class="p">)</span>

    <span class="n">confidence</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># area under whole function</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Get weighted average of PDF</span>
    <span class="n">mid_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">y</span><span class="p">)))</span>
    <span class="c1">#mid_pos = np.argmin(np.abs(x - np.median(x, weights=y)))</span>
    <span class="c1">#mid_pos = np.interp</span>

    <span class="c1"># If the cum sum had duplicates, then multiple median pos will be derived,</span>
    <span class="c1"># take the one in the middle.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mid_pos</span> <span class="o">=</span> <span class="n">mid_pos</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">mid_pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Lower error</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">mid_pos</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">low_area</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>

    <span class="c1">#area = integrate(y[0:mid_pos], x[0:mid_pos])</span>

    <span class="k">while</span> <span class="n">low_area</span> <span class="o">&lt;=</span> <span class="n">area</span> <span class="o">*</span> <span class="n">confidence</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y_clip</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">mid_pos</span><span class="p">]</span><span class="c1"># + 1]</span>
        <span class="n">x_clip</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">mid_pos</span><span class="p">]</span><span class="c1"># + 1]</span>

        <span class="n">low_area</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">y_clip</span><span class="p">,</span> <span class="n">x_clip</span><span class="p">)</span>

        <span class="c1"># Catch the error if going to far</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">break</span>

        <span class="n">pos</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="c1"># set result to lower position</span>
    <span class="n">low_pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">low_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

    <span class="c1"># higher error</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">mid_pos</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">max_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">high_area</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>

    <span class="c1">#area = integrate(y[mid_pos:-1], x[mid_pos:-1])</span>
    <span class="k">while</span> <span class="n">high_area</span> <span class="o">&lt;=</span> <span class="n">area</span> <span class="o">*</span> <span class="n">confidence</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">max_pos</span><span class="p">:</span>
        <span class="n">y_clip</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mid_pos</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>
        <span class="n">x_clip</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mid_pos</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>

        <span class="n">high_area</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">y_clip</span><span class="p">,</span> <span class="n">x_clip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">max_pos</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">max_pos</span>
            <span class="k">break</span>

        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">high_pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="n">max_pos</span><span class="p">:</span>
        <span class="n">high_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">median</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mid_pos</span><span class="p">]</span>
    <span class="n">low_error</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mid_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">low_pos</span><span class="p">]</span>
    <span class="n">high_error</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">high_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">mid_pos</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">median</span><span class="p">,</span> <span class="n">high_error</span><span class="p">,</span> <span class="n">low_error</span>
</div>
<span class="k">def</span> <span class="nf">calc_cdf_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.32</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simps</span> <span class="k">as</span> <span class="n">integrate</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)])</span>

    <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cdf</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1">#mid_pos = np.argmin(np.abs(cdf - 0.5))</span>
        <span class="c1">#low_pos = np.argmin(np.abs(cdf - alpha / 2.0))</span>
        <span class="c1">#high_pos = np.argmin(np.abs(alpha / 2.0 - cdf))</span>
        <span class="c1">#median = y[mid_pos]</span>
        <span class="c1">#low_error = y[mid_pos] - y[low_pos]</span>
        <span class="c1">#high_error = y[high_pos] - y[mid_pos]</span>

        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">low_error</span> <span class="o">=</span> <span class="n">median</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">high_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">median</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">median</span><span class="p">,</span> <span class="p">(</span><span class="n">low_error</span><span class="p">,</span> <span class="n">high_error</span><span class="p">)</span>

<span class="c1"># Bootstrapping using medians</span>
<span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Bootstraps data to determine errors. Resamples the data num_samples</span>
<span class="sd">    times. Returns errors of a bootstrap simulation at the 100.*(1 - alpha)</span>
<span class="sd">    confidence interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array-like</span>
<span class="sd">        Array of data in the form of an numpy.ndarray</span>
<span class="sd">    num_samples : int</span>
<span class="sd">        Number of times to resample the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    conf_int : tuple, float</span>
<span class="sd">        Lower error and upper error at 100*(1-alpha) confidence of the data.</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data. Will have one extra dimension than the</span>
<span class="sd">        data of length num_samples, representing each simulation.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    -&gt; arrays can be initialized with numpy.empty</span>
<span class="sd">    -&gt; random samples can be retrieved from an array with random.sample</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import scipy</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.random.f(1, 2, 100)</span>
<span class="sd">    &gt;&gt;&gt; data.shape</span>
<span class="sd">    (100,)</span>
<span class="sd">    &gt;&gt;&gt; samples = bootstrap(data, 50)</span>
<span class="sd">    &gt;&gt;&gt; samples.shape</span>
<span class="sd">    (50, 100,)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>


    <span class="k">return</span> <span class="n">samples</span>

<span class="k">def</span> <span class="nf">calc_bootstrap_error</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Returns errors of a bootstrap simulation at the 100.*(1 - alpha)</span>
<span class="sd">    confidence interval. Errors are computed by deriving a cumulative</span>
<span class="sd">    distribution function of the medians of the sampled data and determining the</span>
<span class="sd">    distance between the median and the value including alpha/2 % of the data,</span>
<span class="sd">    and the value including alpha/2 % of the data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    conf_int : tuple, float</span>
<span class="sd">        Median of the data, the lower error and the upper error at 100*(1-alpha)</span>
<span class="sd">        confidence of the data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    -&gt; To find the index in an array closest to a given value, use the</span>
<span class="sd">    numpy.argmin function to find the index of the minimum value in an array.</span>
<span class="sd">    For example to find the value closest to 11.1 in an array of 10, 11, and 12:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; a = np.array([10, 11, 12])</span>
<span class="sd">        &gt;&gt;&gt; print(np.argmin(np.abs(a - 11.1)))</span>
<span class="sd">        1</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import scipy</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.random.f(1, 2, 100)</span>
<span class="sd">    &gt;&gt;&gt; samples = bootstrap(data, 50)</span>
<span class="sd">    &gt;&gt;&gt; errors = calc_bootstrap_error(samples, 0.05)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">medians</span><span class="p">,</span> <span class="n">cdf</span> <span class="o">=</span> <span class="n">calc_cdf</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">medians</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))]</span>
    <span class="n">error_low</span> <span class="o">=</span> <span class="n">medians</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">))]</span>
    <span class="n">error_high</span> <span class="o">=</span> <span class="n">medians</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">median</span><span class="p">,</span> <span class="n">median</span> <span class="o">-</span> <span class="n">error_low</span><span class="p">,</span> <span class="n">error_high</span> <span class="o">-</span> <span class="n">median</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calc_cdf</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Calculates a cumulative distribution function of the medians of each</span>
<span class="sd">    instance of resampled data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    medians : array-like</span>
<span class="sd">        Array containing mean values for the cdf.</span>
<span class="sd">    cdf : array-like</span>
<span class="sd">        Array containing fraction of data below value x.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">medians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">medians</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">medians</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">medians</span><span class="p">,</span> <span class="n">cdf</span>

<span class="c1"># Bootstrapping using means</span>
<div class="viewcode-block" id="bootstrap"><a class="viewcode-back" href="../code.html#mystats.bootstrap">[docs]</a><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Bootstraps data to determine errors. Resamples the data num_samples</span>
<span class="sd">    times. Returns errors of a bootstrap simulation at the 100.*(1 - alpha)</span>
<span class="sd">    confidence interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array-like</span>
<span class="sd">        Array of data in the form of an numpy.ndarray</span>
<span class="sd">    num_samples : int</span>
<span class="sd">        Number of times to resample the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    conf_int : tuple, float</span>
<span class="sd">        Lower error and upper error at 100*(1-alpha) confidence of the data.</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data. Will have one extra dimension than the</span>
<span class="sd">        data of length num_samples, representing each simulation.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    -&gt; arrays can be initialized with numpy.empty</span>
<span class="sd">    -&gt; random samples can be retrieved from an array with random.sample</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import scipy</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.random.f(1, 2, 100)</span>
<span class="sd">    &gt;&gt;&gt; data.shape</span>
<span class="sd">    (100,)</span>
<span class="sd">    &gt;&gt;&gt; samples = bootstrap(data, 50)</span>
<span class="sd">    &gt;&gt;&gt; samples.shape</span>
<span class="sd">    (50, 100,)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">samples</span>
</div>
<div class="viewcode-block" id="calc_bootstrap_error"><a class="viewcode-back" href="../code.html#mystats.calc_bootstrap_error">[docs]</a><span class="k">def</span> <span class="nf">calc_bootstrap_error</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Returns errors of a bootstrap simulation at the 100.*(1 - alpha)</span>
<span class="sd">    confidence interval. Errors are computed by deriving a cumulative</span>
<span class="sd">    distribution function of the means of the sampled data and determining the</span>
<span class="sd">    distance between the mean and the value including alpha/2 % of the data,</span>
<span class="sd">    and the value including alpha/2 % of the data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    conf_int : tuple, float</span>
<span class="sd">        Mean of the data, the lower error and the upper error at 100*(1-alpha)</span>
<span class="sd">        confidence of the data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    -&gt; To find the index in an array closest to a given value, use the</span>
<span class="sd">    numpy.argmin function to find the index of the minimum value in an array.</span>
<span class="sd">    For example to find the value closest to 11.1 in an array of 10, 11, and 12:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; a = np.array([10, 11, 12])</span>
<span class="sd">        &gt;&gt;&gt; print(np.argmin(np.abs(a - 11.1)))</span>
<span class="sd">        1</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import scipy</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.random.f(1, 2, 100)</span>
<span class="sd">    &gt;&gt;&gt; samples = bootstrap(data, 50)</span>
<span class="sd">    &gt;&gt;&gt; errors = calc_bootstrap_error(samples, 0.05)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">means</span><span class="p">,</span> <span class="n">cdf</span> <span class="o">=</span> <span class="n">calc_cdf</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cdf</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">means</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))]</span>
    <span class="n">error_low</span> <span class="o">=</span> <span class="n">means</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">))]</span>
    <span class="n">error_high</span> <span class="o">=</span> <span class="n">means</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cdf</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">error_low</span><span class="p">,</span> <span class="n">error_high</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">calc_cdf</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Calculates a cumulative distribution function of the means of each</span>
<span class="sd">    instance of resampled data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples : array-like</span>
<span class="sd">        Array of each resampled data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    means : array-like</span>
<span class="sd">        Array containing mean values for the cdf.</span>
<span class="sd">    cdf : array-like</span>
<span class="sd">        Array containing fraction of data below value x.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">means</span><span class="p">,</span> <span class="n">cdf</span>

<span class="k">def</span> <span class="nf">calc_cdf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">return_axis</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">cdf</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_axis</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cdf</span>

<div class="viewcode-block" id="calc_pdf"><a class="viewcode-back" href="../code.html#mystats.calc_pdf">[docs]</a><span class="k">def</span> <span class="nf">calc_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates probability density function of the data. Uses a non-parametric</span>
<span class="sd">    approach to estimate the PDF.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

    <span class="n">inverse_density_function</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inverse_density_function</span>
</div>
<div class="viewcode-block" id="bootstrap_model"><a class="viewcode-back" href="../code.html#mystats.bootstrap_model">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_model</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">data_error</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Bootstraps data with models a given number of times and calculates the</span>
<span class="sd">    Goodness of fit for each run. The standard deviation of the Goodness-of-fit</span>
<span class="sd">    values is then used to estimate the confidence interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        The observed data, must be the same size as the model</span>
<span class="sd">    model : array_like</span>
<span class="sd">        The model data, must be the same size as the observed data.</span>
<span class="sd">    num_samples : int, optional</span>
<span class="sd">        Number of runs in the bootstrapping.</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Significance of confidence interval.</span>
<span class="sd">    data_error : float, array_like, optional</span>
<span class="sd">        If unset, the error will be the standard deviation of the data. If an</span>
<span class="sd">        array, it must have the same dimensions as the observed data.</span>
<span class="sd">    sigma : float, optional</span>
<span class="sd">        If set, the confidence interval will be calculated using the number of</span>
<span class="sd">        standard deviations from the mean.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Print out progress?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : list</span>
<span class="sd">        A list, [confidence interval, goodness of fit array]</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

    <span class="n">data_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">model_list</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
    <span class="c1">#indices = np.arange(0,length,1)</span>

    <span class="k">if</span> <span class="n">data_error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">data_error_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_error_list</span> <span class="o">=</span> <span class="n">data_error</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">gofArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Beginning bootstrapping&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="c1"># randomly sample all values of data and model</span>
        <span class="n">indices_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data_sample</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">indices_sample</span><span class="p">]</span>
        <span class="n">model_sample</span> <span class="o">=</span> <span class="n">model_list</span><span class="p">[</span><span class="n">indices_sample</span><span class="p">]</span>
        <span class="n">gofArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_sample</span> <span class="o">-</span> <span class="n">model_sample</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> \
                <span class="n">data_error_list</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;th run complete.&#39;</span><span class="p">)</span>

    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">gofArray</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">gofArray</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">confid_int</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">confid_int</span><span class="p">,</span><span class="n">gofArray</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bootstrap_residuals"><a class="viewcode-back" href="../code.html#mystats.bootstrap_residuals">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_residuals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; Bootstraps data with models a given number of times and calculates the</span>
<span class="sd">    Goodness of fit for each run. The standard deviation of the Goodness-of-fit</span>
<span class="sd">    values is then used to estimate the confidence interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        The observed data, must be the same size as the model</span>
<span class="sd">    model : array_like</span>
<span class="sd">        The model data, must be the same size as the observed data.</span>
<span class="sd">    num_samples : int, optional</span>
<span class="sd">        Number of runs in the bootstrapping.</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Significance of confidence interval.</span>
<span class="sd">    data_error : float, array_like, optional</span>
<span class="sd">        If unset, the error will be the standard deviation of the data. If an</span>
<span class="sd">        array, it must have the same dimensions as the observed data.</span>
<span class="sd">    sigma : float, optional</span>
<span class="sd">        If set, the confidence interval will be calculated using the number of</span>
<span class="sd">        standard deviations from the mean.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Print out progress?</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : list</span>
<span class="sd">        A list, [confidence interval, goodness of fit array]</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

    <span class="n">data_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">model_list</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">model</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>

    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">gofArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Beginning bootstrapping&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="c1"># randomly sample all values of data and model</span>
        <span class="n">indices_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data_sample</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="n">indices_sample</span><span class="p">]</span>
        <span class="n">model_sample</span> <span class="o">=</span> <span class="n">model_list</span><span class="p">[</span><span class="n">indices_sample</span><span class="p">]</span>
        <span class="n">gofArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_sample</span> <span class="o">-</span> <span class="n">model_sample</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> \
                <span class="n">data_error_list</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;th run complete.&#39;</span><span class="p">)</span>

    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">gofArray</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">gofArray</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">confid_int</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">confid_int</span><span class="p">,</span><span class="n">gofArray</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_rms"><a class="viewcode-back" href="../code.html#mystats.get_rms">[docs]</a><span class="k">def</span> <span class="nf">get_rms</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Calculates the rms of an array.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
</div>
<span class="k">def</span> <span class="nf">fvalue</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">dof1</span><span class="p">,</span><span class="n">dof2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">chi1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dof1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">chi2</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dof2</span><span class="p">))</span>

<div class="viewcode-block" id="ftest"><a class="viewcode-back" href="../code.html#mystats.ftest">[docs]</a><span class="k">def</span> <span class="nf">ftest</span><span class="p">(</span><span class="n">chi1</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span><span class="n">dof1</span><span class="p">,</span><span class="n">dof2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; The function ftest() c omputes the probability for a value drawn</span>
<span class="sd">    from the F-distribution to equal or exceed the given value of F.</span>
<span class="sd">    This can be used for confidence testing of a measured value obeying</span>
<span class="sd">    the F-distribution (i.e., ffor testing the ratio of variances, or</span>
<span class="sd">    equivalently for the addition of parameters to a fitted model).</span>

<span class="sd">      P_F(X &gt; F; DOF1, DOF2) = PROB</span>

<span class="sd">    In specifying the returned probability level the user has three</span>
<span class="sd">    choices:</span>

<span class="sd">      * return the confidence level when the /CLEVEL keyword is passed;</span>
<span class="sd">        OR</span>

<span class="sd">      * return the significance level (i.e., 1 - confidence level) when</span>
<span class="sd">        the /SLEVEL keyword is passed (default); OR</span>

<span class="sd">      * return the &quot;sigma&quot; of the probability (i.e., compute the</span>
<span class="sd">        probability based on the normal  distribution) when the /SIGMA</span>
<span class="sd">        keyword is passed.</span>

<span class="sd">    Note that /SLEVEL, /CLEVEL and /SIGMA are mutually exclusive.</span>

<span class="sd">    For the ratio of variance test, the two variances, VAR1 and VAR2,</span>
<span class="sd">    should be distributed according to the chi-squared distribution</span>
<span class="sd">    with degrees of freedom DOF1 and DOF2 respectively.  The F-value is</span>
<span class="sd">    computed as:</span>

<span class="sd">       F = (VAR1/DOF1)  / (VAR2/DOF2)</span>

<span class="sd">    and then the probability is computed as:</span>

<span class="sd">       PROB = MPFTEST(F, DOF1, DOF2, ... )</span>


<span class="sd">    For the test of additional parameters in least squares fitting, the</span>
<span class="sd">    user should perform two separate fits, and have two chi-squared</span>
<span class="sd">    values.  One fit should be the &quot;original&quot; fit with no additional</span>
<span class="sd">    parameters, and one fit should be the &quot;new&quot; fit with M additional</span>
<span class="sd">    parameters.</span>

<span class="sd">      CHI1 - chi-squared value for original fit</span>

<span class="sd">      DOF1 - number of degrees of freedom of CHI1 (number of data</span>
<span class="sd">             points minus number of original parameters)</span>

<span class="sd">      CHI2 - chi-squared value for new fit</span>

<span class="sd">      DOF2 - number of degrees of freedom of CHI2</span>

<span class="sd">    Note that according to this formalism, the number of degrees of</span>
<span class="sd">    freedom in the &quot;new&quot; fit, DOF2, should be less than the number of</span>
<span class="sd">    degrees of freedom in the &quot;original&quot; fit, DOF1 (DOF2 &lt; DOF1); and</span>
<span class="sd">    also CHI2 &lt; CHI1.</span>

<span class="sd">    With the above definition, the F value is computed as:</span>

<span class="sd">      F = ( (CHI1-CHI2)/(DOF1-DOF2) )   /  (CHI2/DOF2)</span>

<span class="sd">    where DOF1-DOF2 is equal to M, and then the F-test probability is</span>
<span class="sd">    computed as:</span>

<span class="sd">       PROB = MPFTEST(F, DOF1-DOF2, DOF2, ... )</span>

<span class="sd">    Note that this formalism assumes that the addition of the M</span>
<span class="sd">    parameters is a small peturbation to the overall fit.  If the</span>
<span class="sd">    additional parameters dramatically changes the character of the</span>
<span class="sd">    model, then the first &quot;ratio of variance&quot; test is more appropriate,</span>
<span class="sd">    where F = (CHI1/DOF1) / (CHI2/DOF2).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">f</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span> <span class="p">(</span><span class="n">chi1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dof1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">chi2</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dof2</span><span class="p">)),</span> <span class="n">dof1</span><span class="p">,</span><span class="n">dof2</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">test_bootstrap</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scikits.bootstrap</span> <span class="kn">import</span> <span class="n">ci</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;std = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">boot_error</span> <span class="o">=</span> <span class="n">calc_bootstrap_error</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">)</span>

    <span class="n">boot_error_ci</span> <span class="o">=</span> <span class="n">ci</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;bootstrap error&#39;</span><span class="p">,</span> <span class="n">boot_error</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;bootstrap error ci&#39;</span><span class="p">,</span> <span class="n">boot_error_ci</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">test_bootstrap</span><span class="p">()</span>

<span class="c1"># Likelihood calculations</span>

<div class="viewcode-block" id="calc_logL"><a class="viewcode-back" href="../code.html#mystats.calc_logL">[docs]</a><span class="k">def</span> <span class="nf">calc_logL</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_error</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates log likelihood</span>

<span class="sd">    http://www.physics.utah.edu/~detar/phys6720/handouts/curve_fit/curve_fit/node2.html</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="k">if</span> <span class="n">data_error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">data_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_error</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">data_error</span> <span class="o">=</span> <span class="n">data_error</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">data_weighted</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">data_error_weighted</span> <span class="o">=</span> <span class="n">data_error</span>
        <span class="n">model_weighted</span> <span class="o">=</span> <span class="n">model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">weights</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">weights</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="n">data_error_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="n">model_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)):</span>
            <span class="n">data_weighted</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">count</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">data_error_weighted</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">count</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">model_weighted</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">count</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1">#logL = -np.nansum((data - model)**2 / (2 * (data_error)**2))</span>
    <span class="n">logL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">data_weighted</span> <span class="o">-</span> <span class="n">model_weighted</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> \
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_error_weighted</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">logL</span>
</div>
<span class="k">def</span> <span class="nf">logL2L</span><span class="p">(</span><span class="n">logL</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="c1"># Normalize the log likelihoods</span>
        <span class="n">logL</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">logL</span><span class="p">)</span>

    <span class="c1"># Convert to likelihoods</span>
    <span class="n">likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logL</span><span class="p">)</span>

    <span class="n">likelihoods</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Normalize the likelihoods</span>
    <span class="n">likelihoods</span> <span class="o">=</span> <span class="n">likelihoods</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">likelihoods</span>

<div class="viewcode-block" id="calc_likelihood_conf"><a class="viewcode-back" href="../code.html#mystats.calc_likelihood_conf">[docs]</a><span class="k">def</span> <span class="nf">calc_likelihood_conf</span><span class="p">(</span><span class="n">likelihoods</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates confidence intervals for each axis.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">conf</span>

    <span class="n">interval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

    <span class="c1">#-2.0 * (np.log(conf) - np.log(</span>

</div>
<span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

    <span class="k">return</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Perumations</span>

<span class="k">def</span> <span class="nf">unique_permutations</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unique_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">first_element</span> <span class="ow">in</span> <span class="n">unique_elements</span><span class="p">:</span>
            <span class="n">remaining_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
            <span class="n">remaining_elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">first_element</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sub_permutation</span> <span class="ow">in</span> <span class="n">unique_permutations</span><span class="p">(</span><span class="n">remaining_elements</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">first_element</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sub_permutation</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">custom_modules 0.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Elijah Bernstein-Cooper.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>